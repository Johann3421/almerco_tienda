import{m as r,h as me,p as pe,r as X,f as a,o as s,b as t,n as y,F as U,s as R,t as c,g as n,a as k,w as I,e as F,u as Z,j as ve,c as M,i as h,M as C}from"./app-Bt6ztAfV.js";import fe from"./CartCompra-DToj7Pn6.js";import xe from"./CartPromo-ClQY1Lh7.js";import{u as ge}from"./OrderStore-B13r27UW.js";import be from"./Cabecera-BZKB-Jw6.js";import{_ as _e}from"./AppWebLayout-gtSRl0gO.js";import we from"./NavMobil-CN-jJMiu.js";import"./PapupCant-B_d-Dv1P.js";import"./SettingStore-Dmkk0slu.js";import"./Promotion-BCU-_mBv.js";import"./Nav-BZ68Bjws.js";import"./PapupCarrito-Bn9WbYt6.js";import"./CartMobil-DcDmtq4m.js";import"./logo-Bism2vW4.js";import"./Footer-DB5-MtFP.js";import"./References-07TxyabB.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./favicon-CdIV8-2k.js";const ye="/build/assets/iconocheck-BvpDsaXz.png",he={class:"lg:mt-44 w-full py-5 md:px-10 lg:px-2 2xl:px-20",id:"fixedContent"},Ce={class:"grid bg-gray-100"},De={class:"hidden md:flex flex-col md:flex-row grid-cols-1 justify-around w-full gap-2 border-t"},ke={class:"flex py-2 md:hidden"},Ee={class:"flex overflow-x-auto items-center w-full"},Se=["onClick"],je={class:"relative w-full"},Pe={key:0,id:"resumencompra",class:"flex flex-col lg:flex-row justify-between lg:items-start w-full"},Fe={class:"flex flex-col w-full justify-between p-2"},Ie={class:"hidden md:flex md:justify-between md:items-center w-full p-4 bg-gray-50 text-xl font-bold"},Oe={class:""},Ae={class:"text-sm"},Ne={class:"flex flex-col md:flex-row lg:flex-col items-center justify-center bg-gray-100 p-2"},Ve={class:"flex flex-col gap-2 items-center border rounded-md px-8 bg-white py-5 w-full md:w-1/2 lg:w-72"},Le={class:"flex flex-col w-full md:w-60 text-center text-lg"},$e={key:0,class:"flex w-full justify-between"},Ue={class:"flex flex-col"},Re={key:1,class:"flex w-full justify-between"},Me={class:"flex flex-col"},Ge={key:2,class:"flex w-full justify-between"},Te={key:3,class:"flex w-full justify-between"},Be={key:4,class:"flex w-full justify-between"},qe={class:"flex w-full justify-between font-bold"},ze={class:"text-center"},Je={class:""},Ye={class:"md:w-80 lg:p-2"},He={class:"md:px-2 py-2 h-full"},We={key:1,id:"datoscliente",ref:"form_create_order",class:"flex flex-col gap-4 w-full p-5 bg-white border rounded-xl"},Xe={class:"w-full flex flex-col md:flex-row justify-between gap-5 text-blue-600 font-bold"},Ze={class:"w-full flex flex-col md:flex-row gap-5",id:"datos"},Ke={class:"flex flex-col gap-3 md:w-1/2"},Qe={class:"flex flex-col md:flex-row w-full gap-2 justify-between"},et={key:0,class:"flex flex-col gap-2 md:w-1/2"},tt={key:0,class:"text-red-500"},ot={key:1,class:"flex flex-col gap-2 md:w-1/2"},lt={key:0,class:"text-red-500"},st={class:"flex flex-col gap-2 md:w-1/2"},at={key:0,class:"text-red-500"},rt={key:0,class:"flex flex-col gap-2"},nt={key:0,class:"text-red-500"},it={key:1,class:"flex flex-col gap-2"},ut={key:0,class:"text-red-500"},dt={class:"flex flex-col lg:w-1/2 gap-2"},ct={class:"flex flex-col gap-2"},mt={key:0,class:"text-red-500"},pt={class:"flex flex-col gap-2"},vt={key:0,class:"text-red-500"},ft={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50"},xt={class:"w-full flex flex-col xl:flex-row gap-2 justify-end"},gt={key:2,id:"pago",class:"w-full h-full py-10 px-4 bg-white flex flex-col justify-between items-center gap-2"},bt={class:"flex flex-col md:flex-row items-center justify-center h-60 md:h-full gap-2"},_t={class:"w-full md:w-auto md:text-center"},wt=["src"],yt={class:"flex flex-col justify-start items-start text-left leading-tight"},ht={class:"leading-tight"},Ct={class:"text-rojo font-medium"},Dt={class:"md:p-3 w-full text-center"},kt=["href"],Et={__name:"Index",props:{images:Object,products:Array},setup(x){const g=x,p=r("resumencompra"),u=r("boleta"),O=r([]),G=r([]),E=r(""),v=r(""),b=r(""),S=r(""),D=r(""),T=r(""),B=r("dni"),q=()=>{E.value="",v.value="",b.value="",S.value="",D.value=""},K=ge(),m=r({id:"",customer_name:"",customer_email:"",customer_phone:"",customer_address:"",customer_document_number:"",customer_document_type:1,order_status:"",order_status_update:"Cancelado",order_code:"",order_total:0,observation:"",delivery_date:"",active:!0,items:[{id:0,uuid:crypto.randomUUID(),product_id:0,amount:0,unit_price:0,unit_stock:0,unit_name:"",total:0}]}),A=r(!1),N=r(""),Q=me(()=>`https://wa.me/51991375813?text=¡Hola!%20,%20quiero%20saber%20sobre%20mi%20Orden%20de%20Compra%20:%0A${encodeURIComponent(`*${N.value}*`)}`),z=()=>{u.value==="boleta"?v.value.length!==8&&(v.value="",b.value="",B.value="ruc"):v.value.length!==11&&(v.value="",b.value="",B.value="dni")},j=l=>{p.value=l},ee=r([{name:"resumencompra",label:"RESUMEN DE COMPRA",iconClass:"mdi mdi-numeric-1-box-outline text-4xl"},{name:"datoscliente",label:"DATOS DEL CLIENTE",iconClass:"mdi mdi-numeric-2-box-outline text-4xl"},{name:"pago",label:"ENVIO Y PAGO",iconClass:"mdi mdi-numeric-3-box-outline text-4xl"}]),V=r(0),_=r([]),L=r([]);L.value=g.products;const f=r(0),w=r("exonerada"),J=()=>{_.value=JSON.parse(localStorage.getItem("producto"))||[],V.value=_.value.length,f.value=_.value.reduce((l,e)=>l+e.subtotalsoles,0)},Y=l=>(l*.18).toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2}),H=l=>(l*.15254237288135586).toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2}),te=l=>{const e=parseFloat(H(l));return(l-e).toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2})},W=l=>w.value==="mas"?(parseFloat(l)+parseFloat(Y(l))).toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2}):w.value==="incluido"?parseFloat(l).toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2}):parseFloat(l).toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2}),oe=()=>{g.images&&g.images.length>0&&_.value.forEach(l=>{const e=g.images.filter(d=>d.product_id===l.id);O.value.push({product_id:l.id,imagenes:e})})},le=()=>{g.images&&g.images.length>0&&L.value.forEach(l=>{const e=g.images.filter(d=>d.product_id===l.id);G.value.push({product_id:l.id,imagenes:e})})},se=l=>{const e=G.value.find(d=>d.product_id===l);return e?e.imagenes:[]},ae=l=>{const e=O.value.find(d=>d.product_id===l);return e?e.imagenes:[]},re=()=>{u.value==="factura"&&(u.value="boleta"),z()},ne=()=>{u.value==="boleta"&&(u.value="factura"),z()},i=r({nroDocumento:"",celular:"",nombrecompleto:"",direccion:"",email:""}),ie=()=>(i.value.nroDocumento=v.value?"":"El número de documento es obligatorio",i.value.celular=E.value?"":"El número de celular es obligatorio",i.value.nombrecompleto=b.value?"":"El nombre completo es obligatorio",i.value.direccion=S.value?"":"La dirección es obligatoria",i.value.email=D.value?"":"El correo es obligatorio",Object.values(i.value).every(l=>l==="")),ue=async()=>{if(!ie())return;A.value=!0,m.value.customer_name=b.value,m.value.customer_email=D.value,m.value.customer_phone=E.value,m.value.customer_address=S.value,m.value.customer_document_number=v.value,m.value.customer_document_type=u.value==="boleta"?1:2,m.value.order_status="Pendiente de Pago",m.value.order_code=Math.random().toString(36).substring(7),m.value.observation="Orden de compra generada desde la web",m.value.delivery_date=new Date().toISOString(),m.value.active=!0,T.value=D.value;const l=W(f.value),e=parseFloat(l.replace(/,/g,""));if(isNaN(e)){console.error("El total calculado no es un número válido:",l);return}m.value.order_total=e;const d=_.value.map(o=>({product_id:o.id,amount:o.quantity,unit_price:o.pricesoles,total:o.subtotalsoles,unit_name:"unidad"}));if(d.length===0){console.error("No hay productos en el carrito");return}m.value.items=d;const $={...m.value,items:d};try{const o=await axios.post(route("pedidos.store"),$);o.status===201&&(console.log("Orden de compra generada con éxito",o.data),N.value=o.data.order.order_code,await de(o.data.order.id),K.clearOrderItems(),q(),localStorage.clear(),j("pago"))}catch(o){const P=o.response?o.response.data.message||"Error desconocido":"Error de conexión";alert(`Error al generar la orden de compra: ${P}`),o.response&&o.response.data.errors&&alert(`Errores de validación: ${JSON.stringify(o.response.data.errors)}`)}finally{A.value=!1}},de=async l=>{try{const e=await axios.post(`/orders/${l}/send-confirmation`);console.log("Correo enviado con éxito:",e.data)}catch(e){const d=e.response?e.response.data.message||"Error desconocido":"Error de conexión";alert(`Error al enviar el correo: ${d}`)}},ce=()=>{if(_.value.length===0){console.error("No hay productos en el carrito"),window.location.href="/";return}};return pe(()=>{J(),ce(),oe(),le(),j("resumencompra")}),(l,e)=>{const d=X("v-carousel-item"),$=X("v-carousel");return s(),a("div",he,[t("div",Ce,[t("div",De,[t("span",{class:y(["p-3 w-full text-center text-plomomediooscuro rounded hover:text-greenhad flex items-center justify-center",{"text-green-700  font-bold":p.value==="resumencompra"}])},e[9]||(e[9]=[t("i",{class:"mdi mdi-numeric-1-box-outline text-4xl"},null,-1),t("span",null,"RESUMEN DE COMPRA",-1)]),2),t("span",{class:y(["p-3 w-full text-center text-plomomediooscuro rounded hover:text-greenhad flex items-center justify-center",{"text-green-700 font-bold":p.value==="datoscliente"}])},e[10]||(e[10]=[t("i",{class:"mdi mdi-numeric-2-box-outline text-4xl"},null,-1),t("span",null,"DATOS DEL CLIENTE",-1)]),2),t("span",{class:y(["p-3 w-full text-center text-plomomediooscuro rounded hover:text-greenhad flex items-center justify-center",{"text-green-700  font-bold":p.value==="pago"}])},e[11]||(e[11]=[t("i",{class:"mdi mdi-numeric-3-box-outline text-4xl"},null,-1),t("span",null,"ENVIO Y PAGO",-1)]),2)]),t("div",ke,[t("div",Ee,[(s(!0),a(U,null,R(ee.value,(o,P)=>(s(),a("span",{key:P,class:y(["p-3 w-full text-center text-plomomediooscuro rounded hover:text-rojo flex items-center justify-center",{"font-bold":p.value===o.name,hidden:p.value!==o.name}]),onClick:jt=>j(o.name)},[t("i",{class:y(o.iconClass)},null,2),t("span",null,c(o.label),1)],10,Se))),128))])]),t("div",je,[p.value==="resumencompra"?(s(),a("div",Pe,[t("div",Fe,[t("div",Ie,[t("p",Oe,"Total "+c(V.value)+" productos",1),k(Z(ve),{href:l.route("web"),class:"rounded-full text-greenhad"},{default:I(()=>e[12]||(e[12]=[F(" Seguir comprando")])),_:1},8,["href"])]),t("ul",Ae,[(s(!0),a(U,null,R(V.value,o=>(s(),M(fe,{key:o,index:o,producto:_.value[o-1],onProductoEliminado:J,images:_.value[o-1]?ae(_.value[o-1].id):[]},null,8,["index","producto","images"]))),128))])]),t("div",Ne,[t("div",Ve,[e[21]||(e[21]=t("h1",{class:"font-bold"},"Subtotal de Compra",-1)),t("div",Le,[w.value!=="incluido"&&f.value>0?(s(),a("div",$e,[e[13]||(e[13]=t("span",null,"Subtotal ",-1)),t("div",Ue,[t("span",null,"S/. "+c(f.value.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),1)])])):n("",!0),w.value==="incluido"&&f.value>0?(s(),a("div",Re,[e[14]||(e[14]=t("span",null,"Subtotal ",-1)),t("div",Me,[t("span",null,"S/. "+c(te(f.value)),1)])])):n("",!0),e[19]||(e[19]=t("hr",null,null,-1)),w.value==="mas"&&f.value>0?(s(),a("div",Ge,[e[15]||(e[15]=t("span",null,"IGV ",-1)),t("span",null,"S/. "+c(Y(f.value)),1)])):n("",!0),w.value==="incluido"&&f.value>0?(s(),a("div",Te,[e[16]||(e[16]=t("span",null,"IGV ",-1)),t("span",null,"S/. "+c(H(f.value)),1)])):n("",!0),w.value==="exonerada"?(s(),a("div",Be,e[17]||(e[17]=[t("span",null,"IGV ",-1),t("span",null,"S/. 0.00 ",-1)]))):n("",!0),e[20]||(e[20]=t("hr",null,null,-1)),t("div",qe,[e[18]||(e[18]=t("span",null,"Total ",-1)),t("span",null,"S/. "+c(W(f.value)),1)])]),t("div",ze,[t("button",{href:"#",onClick:e[0]||(e[0]=o=>j("datoscliente")),class:"rounded-full border bg-rojo hover:bg-greenhad px-10 py-2 text-xs font-bold text-white"},"FINALIZAR COMPRA")])]),t("div",Je,[t("div",Ye,[k($,{"hide-delimiters":"","show-arrows":"hover",cycle:"",style:{height:"100%"}},{default:I(()=>[(s(!0),a(U,null,R(L.value,(o,P)=>(s(),M(d,{key:P},{default:I(()=>[t("div",He,[k(xe,{producto:o,image:se(o.id)},null,8,["producto","image"])])]),_:2},1024))),128))]),_:1})])])])])):n("",!0),p.value==="datoscliente"?(s(),a("div",We,[e[30]||(e[30]=t("h2",{class:"font-medium text-2xl text-center"},"Datos de Facturación",-1)),t("div",Xe,[t("button",{class:y(["hover:bg-blue-700 hover:text-white px-5 py-3 rounded-lg border md:w-1/2 text-left",{"bg-blue-700 text-white":u.value==="boleta"}]),onClick:re},"BOLETA",2),t("button",{class:y(["hover:bg-blue-700 hover:text-white px-5 py-3 rounded-lg border md:w-1/2 text-left",{"bg-blue-700 text-white":u.value==="factura"}]),onClick:ne},"FACTURA",2)]),t("div",Ze,[t("div",Ke,[t("div",Qe,[u.value==="boleta"?(s(),a("div",et,[e[22]||(e[22]=t("label",{for:"nroDocumento"},"Dni:",-1)),h(t("input",{type:"text",id:"nroDocumento","onUpdate:modelValue":e[1]||(e[1]=o=>v.value=o),class:"w-full border p-3 rounded-xl",required:"",maxlength:"8"},null,512),[[C,v.value]]),i.value.nroDocumento?(s(),a("span",tt,c(i.value.nroDocumento),1)):n("",!0)])):n("",!0),u.value==="factura"?(s(),a("div",ot,[e[23]||(e[23]=t("label",{for:"nroDocumento"},"Ruc:",-1)),h(t("input",{type:"text",id:"nroDocumento","onUpdate:modelValue":e[2]||(e[2]=o=>v.value=o),class:"w-full border p-3 rounded-xl",required:"",maxlength:"11"},null,512),[[C,v.value]]),i.value.nroDocumento?(s(),a("span",lt,c(i.value.nroDocumento),1)):n("",!0)])):n("",!0),t("div",st,[e[24]||(e[24]=t("label",{for:"celular"},"Nro. de Celular:",-1)),h(t("input",{type:"text",id:"celular","onUpdate:modelValue":e[3]||(e[3]=o=>E.value=o),class:"w-full border p-3 rounded-xl",maxlength:"12"},null,512),[[C,E.value]]),i.value.celular?(s(),a("span",at,c(i.value.celular),1)):n("",!0)])]),u.value==="boleta"?(s(),a("div",rt,[e[25]||(e[25]=t("label",{for:"nombrecompleto"},"Nombre Completo:",-1)),h(t("input",{type:"text",id:"nombrecompleto","onUpdate:modelValue":e[4]||(e[4]=o=>b.value=o),class:"w-full border p-3 rounded-xl"},null,512),[[C,b.value]]),i.value.nombrecompleto?(s(),a("span",nt,c(i.value.nombrecompleto),1)):n("",!0)])):n("",!0),u.value==="factura"?(s(),a("div",it,[e[26]||(e[26]=t("label",{for:"nombrecompleto"},"Razón Social:",-1)),h(t("input",{type:"text",id:"nombrecompleto","onUpdate:modelValue":e[5]||(e[5]=o=>b.value=o),class:"w-full border p-3 rounded-xl"},null,512),[[C,b.value]]),i.value.nombrecompleto?(s(),a("span",ut,c(i.value.nombrecompleto),1)):n("",!0)])):n("",!0)]),t("div",dt,[t("div",ct,[e[27]||(e[27]=t("label",{for:"direccion"},"Dirección:",-1)),h(t("input",{type:"text",id:"direccion","onUpdate:modelValue":e[6]||(e[6]=o=>S.value=o),class:"w-full border p-3 rounded-xl",required:""},null,512),[[C,S.value]]),i.value.direccion?(s(),a("span",mt,c(i.value.direccion),1)):n("",!0)]),t("div",pt,[e[28]||(e[28]=t("label",{for:"email"},"Correo: (Donde se enviará el detalle de la compra)",-1)),h(t("input",{type:"email",id:"email",name:"email",multiple:"","onUpdate:modelValue":e[7]||(e[7]=o=>D.value=o),class:"w-full border p-3 rounded-xl",required:""},null,512),[[C,D.value]]),i.value.email?(s(),a("span",vt,c(i.value.email),1)):n("",!0)])])]),A.value?(s(),a("div",ft,e[29]||(e[29]=[t("div",{class:"bg-white p-6 rounded-lg shadow-lg text-center"},[t("div",{class:"text-xl font-bold mb-4"},"Cargando..."),t("div",{class:"loader-animation w-10 h-10 border-4 border-gray-200 border-t-blue-500 rounded-full animate-spin mx-auto"})],-1)]))):n("",!0),t("div",xt,[t("button",{class:"border bg-blue-700 text-white rounded-xl px-10 py-2 text-lg hover:bg-blue-500 font-bold",onClick:e[8]||(e[8]=o=>j("resumencompra"))},"VOLVER"),t("button",{class:"border bg-green-600 text-white rounded-xl px-10 py-2 text-lg hover:bg-green-700 font-bold",onClick:ue},"GUARDAR"),t("button",{class:"border bg-rojo text-white rounded-xl px-10 py-2 text-lg hover:bg-red-700 font-bold",onClick:q},"CANCELAR")])],512)):n("",!0),p.value==="pago"?(s(),a("div",gt,[t("div",bt,[t("div",_t,[t("img",{class:"w-20",src:Z(ye),alt:""},null,8,wt)]),t("div",yt,[e[34]||(e[34]=t("div",{class:"items-start text-lg font-bold leading-tight"},[t("p",null,"Su pedido fue"),t("p",null,"registrado exitosamente")],-1)),t("p",ht,[e[31]||(e[31]=F("Nota: Los datos del pedido han sido enviados al ")),e[32]||(e[32]=t("br",null,null,-1)),e[33]||(e[33]=F(" correo: ")),t("span",Ct,c(T.value),1)])])]),t("div",Dt,[N.value?(s(),a("a",{key:0,href:Q.value,class:"w-full bg-green-500 text-white md:text-lg font-bold py-3 px-5 md:px-10 rounded-full",target:"_blank"},e[35]||(e[35]=[t("i",{class:"mdi mdi-whatsapp font-bold text-2xl"},null,-1),F(" Consulta vía WhatsApp ")]),8,kt)):n("",!0)])])):n("",!0)])])])}}},St={class:"mt-12"},Yt={__name:"Index",props:{categories:Array,images:Object,products:Array},setup(x){const g=r([]),p=u=>{g.value=u};return(u,O)=>(s(),M(_e,{title:"Grupo Almerco",class:"bg-fondoback",categories:x.categories},{default:I(()=>[k(be,{onSearchChange:p,categories:x.categories,images:x.images},null,8,["categories","images"]),t("div",St,[k(Et,{images:x.images,products:x.products},null,8,["images","products"])]),k(we,{categories:x.categories,images:x.images},null,8,["categories","images"])]),_:1},8,["categories"]))}};export{Yt as default};
